@page "/LoginRegister"
@using ShopApplication.Infrastructure.Identity
@using ShopApplication.Types
<h3>LoginRegister</h3>

<div style="max-width: 360px" class="mt-5 mx-auto text-center">
    <img class="mb-4" src="/Images/Logo.svg" alt="blazor" width="72" height="57">

    <EditForm Model="_login" OnValidSubmit="@(async () => await Login() )">
        <h1 class="h3 mb-3 fw-normal">Please sign in</h1>
        <DataAnnotationsValidator/>
        <div class="form-floating">
            <InputText type="name" class="form-control" id="emailOrUsername" @bind-Value="@_login.EmailOrUsername">></InputText>
            <label for="emailOrUsername">Email or Username</label>
        </div>
        <div class="form-floating">
            <InputText type="password" class="form-control" id="password" @bind-Value="@_login.Password"></InputText>
            <label for="password">Password</label>
        </div>
        <button class="w-100 btn btn-lg btn-primary" type="submit">Sign in</button>
    </EditForm>

    <span class="my-5 d-block text-muted">- Or -</span>

    <EditForm Model="_register" OnValidSubmit="@(async () => await Register() )">
        <h1 class="h3 mb-3 fw-normal">Register</h1>
        <DataAnnotationsValidator/>
        <div class="form-floating">
            <InputText type="name" class="form-control" id="username" @bind-Value="@_register.Username"></InputText>
            <ValidationMessage For="@(() => _register.Username)"/>
            <label for="emailOrUsername">Username</label>
        </div>
        <div class="form-floating">
            <InputText type="email" class="form-control" id="email" @bind-Value="@_register.Email"></InputText>
            <ValidationMessage For="@(() => _register.Email)"/>
            <label for="email">Email</label>
        </div>
        <div class="form-floating">
            <InputText type="password" class="form-control" id="registerPassword" @bind-Value="@_register.Password"></InputText>
            <ValidationMessage For="@(() => _register.Password)"/>
            <label for="registerPassword">Password</label>
        </div>
        <div class="form-floating">
            <InputText type="password" class="form-control" id="confirmPassword" @bind-Value="@_register.PasswordConfirm"></InputText>
            <ValidationMessage For="@(() => _register.PasswordConfirm)"/>
            <label for="confirmPassword">Confirm Password</label>
        </div>
        <button class="w-100 btn btn-lg btn-primary" type="submit">Register</button>
    </EditForm>

    <AlertMessage Page="@this"></AlertMessage>
</div>

@code {
    [Inject] NavigationManager Navigation { get; init; } = default!;
    [Inject] IIdentityManager IdentityManager { get; init; } = default!;
    //[Inject] CartManager CartManager { get; init; } = default!;

    readonly Login _login = new();
    readonly Register _register = new();

    async Task Login()
    {
        /*ApiReply<User?> reply = await IdentityManager.Login( _login );

        if (reply.Data is null) {
            Alert( AlertType.Danger, reply.Details() );
            return;
        }

        await CartManager.GetCart( reply.Data.Token );

        Navigation.NavigateTo( "/" );*/
    }
    async Task Register()
    {
        /*ApiReply<bool> reply = await IdentityManager.Register( _register );

        if (!reply.Data) {
            Alert( AlertType.Danger, reply.Details() );
            return;
        }

        Navigation.NavigateTo( "/registered" );*/
    }
}